(()=>{"use strict";function t(t,e,n){var i=null;return t&&(i=window.document.createElement(t)),e&&i.classList.add(e),n&&(i.innerHTML=n),i}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var n=function(){function n(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var i=e.left,s=e.top,a=e.ind;this.puzzle=t,this.width=t.width,this.left=i,this.top=s,this.ind="number"==typeof a?a:"",this.image=t.image,this.q=t.q,this.size=this.width/this.q,this.bgPosX=e.bgPosX,this.bgPosY=e.bgPosY}var i,s;return i=n,(s=[{key:"getPos",value:function(){this.bgPosX="".concat(-this.left*this.size,"px"),this.bgPosY="".concat(-this.top*this.size,"px")}},{key:"render",value:function(){return this.container=t("div","fieldcell","".concat(this.ind)),this.container.style.backgroundImage="url(./assets/images/".concat(this.image,")"),this.container.style.backgroundSize="".concat(this.width,"px"),this.container.style.width="".concat(this.size,"px"),this.container.style.height="".concat(this.size,"px"),this.container.style.top="".concat(this.top*this.size,"px"),this.container.style.left="".concat(this.left*this.size,"px"),this.container.style.backgroundPositionX=this.bgPosX,this.container.style.backgroundPositionY=this.bgPosY,this.q>5?this.container.style.fontSize="16px":this.container.style.fontSize="36px",""===this.ind&&(this.container.style.opacity="0"),this.container}}])&&e(i.prototype,s),n}();function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var s,a=function(t){if(Array.isArray(t))return i(t)}(s=Array(148).keys())||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(s)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(s)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function l(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}a=a.map((function(t){return"".concat(t+1,".jpg")})),console.log(a);var h=function(){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.settings=n,this.image=this._getImage(a),this.moves=0,this.q=4,this.buttons=[],this.correctTemplate=[],this.container=t("div","gamefield"),this.overlay=t("span","overlay"),this.width=this.settings.width,this.count=0,this.currentTemplate=[],this.prevQ=null,this.init()}var i,s;return i=e,(s=[{key:"init",value:function(){this.container.style.width="".concat(this.width,"px"),this.container.style.height="".concat(this.width,"px"),d.appendChild(this.container),this.container.appendChild(this.overlay),this.makeCorrectTemplate(),this.render(this.correctTemplate)}},{key:"makeCorrectTemplate",value:function(){this.correctTemplate=[];for(var t=0;t<Math.pow(this.q,2)-1;t++){var e=t%this.q,i=(t-e)/this.q,s=t+1;this.correctTemplate.push(new n(this,Object.assign({},{left:e,top:i,ind:s})))}this.correctTemplate.push(new n(this,Object.assign({},{left:this.q-1,top:this.q-1,ind:""}))),this.correctTemplate.forEach((function(t){return t.getPos()}))}},{key:"loadGame",value:function(t){var e=this,i=t.size,s=t.image,a=t.moves,o=t.template;this.q=i,this.image=s,this.moves=a,this.currentTemplate=o,this.makeCorrectTemplate(),this.buttons=[],this.currentTemplate.forEach((function(t){return e.buttons.push(new n(e,t))})),document.querySelector(".move").innerHTML="Moves: ".concat(this.moves),this.deleteCells(),this.render(this.buttons)}},{key:"render",value:function(t){var e=this;t.forEach((function(t){var n=t.render();n.addEventListener("click",e.moveButton.bind(e)),e.container.appendChild(n)}))}},{key:"shuffle",value:function(){var t=this,e=r(this.correctTemplate).pop();this.buttons=[];for(var i=r(Array(Math.pow(this.q,2)-1).keys()).sort((function(){return Math.random()-.5})).map((function(t){return t+1})),s=function(e){var s=e%t.q,a=(e-s)/t.q,o=i[e],r=t.correctTemplate.find((function(t){return t.ind===o})),c=new n(t,Object.assign({},{left:s,top:a,ind:o})),l=Object.create(c);l.bgPosX=r.bgPosX,l.bgPosY=r.bgPosY,t.buttons.push(l)},a=0;a<Math.pow(this.q,2)-1;a++)s(a);(e=new n(this,Object.assign({},{left:this.q-1,top:this.q-1,ind:""}))).getPos(),this.buttons.push(e),console.log(this.buttons),this.render(this.buttons)}},{key:"_getImage",value:function(t){return t[Math.floor(Math.random()*t.length)]}},{key:"reset",value:function(){var t=this;this.image=this._getImage(a),this.prevQ=this.q,this.q=this._checkSize(),this.q!==this.prevQ&&this.makeCorrectTemplate(),this.deleteCells(),setTimeout((function(){t.shuffle()}),0),this.moves=0,document.querySelector(".move").innerHTML="Moves: ".concat(this.moves),this.settings.count=0}},{key:"moveButton",value:function(t){var e=this;if("pause"!==this.settings.state){this.currentTemplate=[];var n=t.target.innerHTML,i=this.buttons.find((function(t){return t.ind==n})),s=this.buttons.find((function(t){return""===t.ind}));if(i&&s){var a=i.left,o=i.top,r=s.left,c=s.top;1===Math.abs(a-r)+Math.abs(o-c)&&(this.moves++,document.querySelector(".move").innerHTML="Moves: ".concat(this.moves),Object.assign(s,{left:a,top:o}),i.left=r,i.top=c,i.container.style.top="".concat(i.top*i.size,"px"),i.container.style.left="".concat(i.left*i.size,"px"),s.container.style.top="".concat(s.top*s.size,"px"),s.container.style.left="".concat(s.left*s.size,"px"),this.buttons.forEach((function(t){var n=t.left,i=t.top,s=t.ind,a=t.bgPosY,o=t.bgPosX;e.currentTemplate.push({left:n,top:i,ind:s,bgPosY:a,bgPosX:o})})),this.checkTemplate())}}}},{key:"checkTemplate",value:function(){for(var t=this,e=function(e){var n=e+1,i=t.correctTemplate.find((function(t){return t.ind===n})),s=t.buttons.find((function(t){return t.ind===n}));return i.left!==s.left||i.top!==s.top?{v:void 0}:void 0},n=0;n<this.buttons.length-1;n++){var i=e(n);if("object"===o(i))return i.v}this.ifWin()}},{key:"ifWin",value:function(){this.buttons.find((function(t){return""===t.ind})).container.style.opacity="1",alert("вы победили")}},{key:"_checkSize",value:function(){return+document.querySelector("input[name=size]:checked").value}},{key:"deleteCells",value:function(){var t=this;r(this.container.children).forEach((function(e){e!==t.overlay&&(e.removeEventListener("click",t.moveButton.bind(t)),t.container.removeChild(e))}))}}])&&l(i.prototype,s),e}();function u(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var d=t("div","game-wrapper");document.body.prepend(d),new(function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.state="start",this.time=null,this.sound="off",this.width=this._getWidth(),this.container=t("div","gameSettings-wrapper"),this.menuList=t("ul","menu__list"),this.settings=t("div","settings-page"),this.bestScore=t("div","best-score"),this.savedGames=t("div","saved-games"),this.parent=t("div","parent"),this.count=0,this.progressIdentifier=null,console.log(this.width),this.init()}var n,i;return n=e,(i=[{key:"_getWidth",value:function(){return+document.documentElement.clientWidth>500?400:300}},{key:"init",value:function(){d.appendChild(this.container),this.game=new h(this),this.menuRender(),this.settingsRender(),this.bestScoreRender(),this.savedGamesRender(),this.game.overlay.appendChild(this.parent),this.parent.appendChild(this.menuList),this.parent.appendChild(this.settings),this.parent.appendChild(this.bestScore),this.parent.appendChild(this.savedGames);var e=this.parent.children;this.children=Array.from(e),this.stateButton=t("span","state-btn","Pause");var n=t("div","time","Time: ".concat(this.count)),i=t("div","move","Moves: ".concat(this.game.moves));this.container.appendChild(this.stateButton),this.container.appendChild(n),this.container.appendChild(i),document.addEventListener("click",this.handleEvent.bind(this))}},{key:"handleEvent",value:function(t){"on"===this.sound&&this.playSound();var e=t.target;if("Resume"===e.innerText||"Pause"===e.innerText){if(console.log(e),"Pause"===e.innerText&&"start"===this.state)return;"Pause"===e.innerText&&"playing"===this.state?(this.state="pause",this.menuList.classList.remove("hidden"),this.game.overlay.classList.remove("hidden"),clearInterval(this.progressIdentifier),e.innerText="Resume"):(this.state="playing",this.progressIdentifier=setInterval(this.tick.bind(this),1e3),this.children.forEach((function(t){t.classList.length<2&&t.classList.add("hidden")})),this.game.overlay.classList.add("hidden"),e.innerText="Pause")}if(e.dataset.link)"newGame"===e.dataset.link?(this.state="playing","Resume"===this.stateButton.innerText&&(this.stateButton.innerText="Pause"),this.menuList.classList.add("hidden"),this.game.overlay.classList.add("hidden"),this.progressIdentifier=setInterval(this.tick.bind(this),1e3),this.game.reset()):"settings"===e.dataset.link?(this.menuList.classList.add("hidden"),this.settings.classList.remove("hidden")):"bestScores"===e.dataset.link?(this.menuList.classList.add("hidden"),this.bestScore.classList.remove("hidden")):"back"===e.dataset.link?(this.children.forEach((function(t){t.classList.length<2&&t.classList.add("hidden")})),this.menuList.classList.remove("hidden")):"loadGame"===e.dataset.link?this.getGame():"saveGame"===e.dataset.link&&this.saveGame();else if(e.dataset.sound){var n=document.getElementById("sound");"off"===this.sound?(e.dataset.sound="on",n.innerText="Sound On",this.sound="on"):(n.innerText="Sound Off",this.sound="off",e.dataset.sound="off")}}},{key:"menuRender",value:function(){this.menuList.innerHTML='\n<span class="menu__link" data-link="newGame">New Game</span>\n <span class="menu__link" data-link="saveGame">Save Game</span>\n <span class="menu__link" data-link="loadGame">Load Game</span>\n <span class="menu__link" data-link="bestScores">Best Scores</span>\n <span class="menu__link" data-link="settings">Settings</span>\n'}},{key:"settingsRender",value:function(){this.settings.classList.add("hidden"),this.settings.innerHTML='<span class="menu-header">Settings</span>\n        <span class="menu-text_big">Field Size</span>\n        <form class=\'form\'>\n    <label for="size" class="menu-text_small">\n           <input type="radio" name="size" id="input" value="3"> 3 X 3\n       </label>\n       <label for="size" class="menu-text_small">\n           <input type="radio" name="size" id="input" value="4" checked> 4 X 4\n       </label>\n       <label for="size" class="menu-text_small">\n       <input type="radio" name="size" id="input" value="5"> 5 X 5\n</label>\n       <label for="size" class="menu-text_small">\n           <input type="radio" name="size" id="input" value="6"> 6 X 6\n   </label>\n   <label for="size" class="menu-text_small">\n   <input type="radio" name="size" id="input" value="7"> 7 X 7\n</label>\n<label for="size" class="menu-text_small">\n<input type="radio" name="size" id="input" value="8"> 8 X 8\n</label>\n    </form>\n    <span id="sound" data-sound="off" class="menu-text_big sound">Sound Off</span>\n    <span class="menu-text_big" id="back" data-link="back" >Go back</span>\n    '}},{key:"bestScoreRender",value:function(){this.bestScore.classList.add("hidden"),this.bestScore.innerHTML='<span class="menu-header">Best Score</span>\n        <ul class="best-score_list">\n        <li class="best-score_link menu-text_small"><span>Moves</span><span>Time</span></li>\n        </ul>\n\n        <span class="menu-text_big" id="back" data-link="back" >Go back</span>\n        '}},{key:"savedGamesRender",value:function(){this.savedGames.classList.add("hidden"),this.savedGames.innerHTML='\n        <span class="load_game menu-text_small">You haven\'t got any saved games yet</span>\n        <span class="menu-text_big" id="back" data-link="back" >Go back</span>\n        '}},{key:"tick",value:function(){this.count++;var t=this.count>=60?this.count%60:this.count,e=Math.floor(this.count/60);document.querySelector(".time").innerHTML="Time: ".concat(this.addZero(e),": ").concat(this.addZero(t))}},{key:"addZero",value:function(t){return t<10?"0".concat(t):"".concat(t)}},{key:"saveGame",value:function(){var t={};t.count=this.count,t.moves=this.game.moves,t.template=this.game.currentTemplate,t.image=this.game.image,t.size=this.game.q;var e=JSON.stringify(t);localStorage.setItem("game",e),document.querySelector(".load_game").innerText="Your game is saved!",this.menuList.classList.add("hidden"),this.savedGames.classList.remove("hidden")}},{key:"getGame",value:function(){var t=localStorage.getItem("game");t||(document.querySelector(".load_game").innerText="You have no saved games yet",this.menuList.classList.add("hidden"),this.savedGames.classList.remove("hidden")),t=JSON.parse(t),this.game.loadGame(t),this.count=t.count,this.tick(),console.log(t)}},{key:"playSound",value:function(){var e=t("audio");e.setAttribute("src","./assets/sounds/english.mp3"),e.load(),e.play(),e=void 0}}])&&u(n.prototype,i),e}())})();