(()=>{"use strict";function t(t,e,n){var s=null;return t&&(s=window.document.createElement(t)),e&&s.classList.add(e),n&&(s.innerHTML=n),s}function e(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var n=function(){function n(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var s=e.left,i=e.top,a=e.ind;this.puzzle=t,this.width=t.width,this.left=s,this.top=i,this.ind="number"==typeof a?a:"",this.image=t.image,this.q=t.q,this.size=this.width/this.q,this.bgPosX=e.bgPosX,this.bgPosY=e.bgPosY}var s,i;return s=n,(i=[{key:"getPos",value:function(){this.bgPosX="".concat(-this.left*this.size,"px"),this.bgPosY="".concat(-this.top*this.size,"px")}},{key:"render",value:function(){return this.container=t("div","fieldcell","".concat(this.ind)),this.container.style.backgroundImage="url(./assets/images/".concat(this.image,")"),this.container.style.backgroundSize="".concat(this.width,"px"),this.container.style.width="".concat(this.size,"px"),this.container.style.height="".concat(this.size,"px"),this.container.style.top="".concat(this.top*this.size,"px"),this.container.style.left="".concat(this.left*this.size,"px"),this.container.style.backgroundPositionX=this.bgPosX,this.container.style.backgroundPositionY=this.bgPosY,this.q>5?this.container.style.fontSize="16px":this.container.style.fontSize="36px",""===this.ind&&(this.container.style.opacity="0"),this.container}}])&&e(s.prototype,i),n}();function s(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var i=function(){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.modal=t("div","modal"),this.layout=t("div","modal__overlay"),this.modalWrapper=t("div","modal__window"),this.gamefield=n,this.animationSpeed=300,this.closing=!1,this.init()}var n,i;return n=e,(i=[{key:"init",value:function(){document.body.appendChild(this.modal),this.modal.appendChild(this.layout),this.layout.dataset.close=!0,this.modalWrapper.innerHTML='  <div class="modal__header"><span  id="close" data-close=\'true\'>&times</span></div>\n        <div class="modal__content"><span class="congrats">Congratulations!</span>\n            <span class="congrats" id=\'solve-with\'></span>\n            <span class=" congrats question">Would you like to play one more game?</span>\n            <div class="buttons__wrapper">\n            <a href="#" class="modal__btn " data-reset=\'true\'>Yes</a>\n            <a href="#" class="modal__btn" data-close=\'true\'>No</a>\n            </div>\n        </div>',this.layout.appendChild(this.modalWrapper)}},{key:"open",value:function(){!this.closing&&this.modal.classList.add("open"),document.getElementById("solve-with").innerText="You solve puzzle in ".concat(this.gamefield.settings.addZero(this.gamefield.settings.min),":").concat(this.gamefield.settings.addZero(this.gamefield.settings.sec)," with ").concat(this.gamefield.moves," moves"),clearInterval(this.gamefield.settings.progressIdentifier),document.body.style.height="100vh",document.body.style.overflow="hidden"}},{key:"close",value:function(){var t=this;this.closing=!0,this.modal.classList.remove("open"),this.modal.classList.add("hide"),setTimeout((function(){t.modal.classList.remove("hide"),t.closing=!1,document.body.style.height="100%",document.body.style.overflow="auto"}),this.animationSpeed)}}])&&s(n.prototype,i),e}();function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}var o,r=function(t){if(Array.isArray(t))return a(t)}(o=Array(148).keys())||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(o)||function(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}function u(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}r=r.map((function(t){return"".concat(t+1,".jpg")}));var d=function(){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.settings=n,this.image=this._getImage(r),this.moves=0,this.q=4,this.buttons=[],this.correctTemplate=[],this.bestScores=this._generateBestScoreArr(),this.container=t("div","gamefield"),this.overlay=t("span","overlay"),this.width=this.settings.width,this.count=0,this.currentTemplate=[],this.prevQ=null,this.init()}var s,a;return s=e,(a=[{key:"init",value:function(){this.container.style.width="".concat(this.width,"px"),this.container.style.height="".concat(this.width,"px"),p.appendChild(this.container),this.container.appendChild(this.overlay),this.modal=new i(this),this.makeCorrectTemplate(),this.render(this.correctTemplate)}},{key:"makeCorrectTemplate",value:function(){this.correctTemplate=[];for(var t=0;t<Math.pow(this.q,2)-1;t++){var e=t%this.q,s=(t-e)/this.q,i=t+1;this.correctTemplate.push(new n(this,Object.assign({},{left:e,top:s,ind:i})))}this.correctTemplate.push(new n(this,Object.assign({},{left:this.q-1,top:this.q-1,ind:""}))),this.correctTemplate.forEach((function(t){return t.getPos()}))}},{key:"loadGame",value:function(t){var e=this;if(t){var s=t.size,i=t.image,a=t.moves,o=t.template;this.q=s,this.image=i,this.moves=a,this.currentTemplate=o,this.makeCorrectTemplate(),this.buttons=[],this.currentTemplate.forEach((function(t){return e.buttons.push(new n(e,t))})),document.querySelector(".move").innerHTML="Moves: ".concat(this.moves),this.deleteCells(),this.render(this.buttons)}}},{key:"render",value:function(t){var e=this;t.forEach((function(t){var n=t.render();n.textContent?(n.draggable=!0,n.addEventListener("dragstart",e.getButton.bind(e))):(n.addEventListener("dragover",e.overButton.bind(e)),n.addEventListener("drop",e.putButton.bind(e))),n.addEventListener("click",e.moveButton.bind(e)),e.container.appendChild(n)}))}},{key:"shuffle",value:function(){var t=this,e=l(this.correctTemplate).pop();this.buttons=[];for(var s=this.sortArray(),i=function(e){var i=e%t.q,a=(e-i)/t.q,o=s[e],r=t.correctTemplate.find((function(t){return t.ind===o})),c=new n(t,Object.assign({},{left:i,top:a,ind:o})),l=Object.create(c);l.bgPosX=r.bgPosX,l.bgPosY=r.bgPosY,t.buttons.push(l)},a=0;a<Math.pow(this.q,2)-1;a++)i(a);(e=new n(this,Object.assign({},{left:this.q-1,top:this.q-1,ind:""}))).getPos(),this.buttons.push(e),this.render(this.buttons)}},{key:"checkSolving",value:function(t){for(var e=this.q,n=0;n<t.length;n++)for(var s=n+1;s<t.length;s++)t[n]>t[s]&&e++;return e%2==0}},{key:"sortArray",value:function(){var t;return t=l(Array(Math.pow(this.q,2)-1).keys()).sort((function(){return Math.random()-.5})).map((function(t){return t+1})),this.checkSolving(t)||this.sortArray(),t}},{key:"_getImage",value:function(t){return t[Math.floor(Math.random()*t.length)]}},{key:"reset",value:function(){var t=this;this.image=this._getImage(r),this.prevQ=this.q,this.q=this._checkSize(),this.q!==this.prevQ&&this.makeCorrectTemplate(),this.deleteCells(),setTimeout((function(){t.shuffle()}),0),this.moves=0,document.querySelector(".move").innerHTML="Moves: ".concat(this.moves),this.settings.count=0}},{key:"moveButton",value:function(t){var e=this;if("pause"!==this.settings.state){this.currentTemplate=[];var n=t.target.innerHTML,s=this.buttons.find((function(t){return t.ind==n})),i=this.buttons.find((function(t){return""===t.ind}));if(s&&i){var a=s.left,o=s.top,r=i.left,c=i.top;1===Math.abs(a-r)+Math.abs(o-c)&&(this.moves++,document.querySelector(".move").innerHTML="Moves: ".concat(this.moves),Object.assign(i,{left:a,top:o}),a!==r?(this.animate("left",s,a,r),s.container.style.top="".concat(s.top*s.size,"px")):(this.animate("top",s,o,c),s.container.style.left="".concat(s.left*s.size,"px")),s.left=r,s.top=c,i.container.style.top="".concat(i.top*i.size,"px"),i.container.style.left="".concat(i.left*i.size,"px"),this.buttons.forEach((function(t){var n=t.left,s=t.top,i=t.ind,a=t.bgPosY,o=t.bgPosX;e.currentTemplate.push({left:n,top:s,ind:i,bgPosY:a,bgPosX:o})})),this.checkTemplate())}}}},{key:"animate",value:function(t,e,n,s){var i=10*Math.abs(s-n)/300,a=setInterval((function(){n<s?(n=Math.min(s,n+i))>=s&&clearInterval(a):n>s&&(n=Math.max(s,n-i))<=s&&clearInterval(a),e.container.style[t]="".concat(n*e.size,"px")}),10)}},{key:"getButton",value:function(t){if("pause"!==this.settings.state){var e=t.target.innerHTML;this.clickedObj=this.buttons.find((function(t){return t.ind==e}))}}},{key:"putButton",value:function(t){var e=this;this.currentTemplate=[];var n=this.buttons.find((function(t){return""===t.ind}));if(this.clickedObj&&n){var s=this.clickedObj,i=s.left,a=s.top,o=n.left,r=n.top;1===Math.abs(i-o)+Math.abs(a-r)&&(this.moves++,document.querySelector(".move").innerHTML="Moves: ".concat(this.moves),Object.assign(n,{left:i,top:a}),this.clickedObj.left=o,this.clickedObj.top=r,this.clickedObj.container.style.top="".concat(this.clickedObj.top*this.clickedObj.size,"px"),this.clickedObj.container.style.left="".concat(this.clickedObj.left*this.clickedObj.size,"px"),n.container.style.top="".concat(n.top*n.size,"px"),n.container.style.left="".concat(n.left*n.size,"px"),this.buttons.forEach((function(t){var n=t.left,s=t.top,i=t.ind,a=t.bgPosY,o=t.bgPosX;e.currentTemplate.push({left:n,top:s,ind:i,bgPosY:a,bgPosX:o})})),this.checkTemplate())}}},{key:"overButton",value:function(t){t.preventDefault()}},{key:"checkTemplate",value:function(){for(var t=this,e=function(e){var n=e+1,s=t.correctTemplate.find((function(t){return t.ind===n})),i=t.buttons.find((function(t){return t.ind===n}));return s.left!==i.left||s.top!==i.top?{v:void 0}:void 0},n=0;n<this.buttons.length-1;n++){var s=e(n);if("object"===c(s))return s.v}this.ifWin()}},{key:"ifWin",value:function(){this.buttons.find((function(t){return""===t.ind})).container.style.opacity="1",document.querySelectorAll(".fieldcell").forEach((function(t){return t.innerText=""}));var t={};t.moves=this.moves,t.size=this.q,t.count=this.settings.count,this.bestScores.push(t);var e=JSON.stringify(this.bestScores);localStorage.setItem("bestScores",e),this.settings.generateBestScores(),this.modal.open()}},{key:"_generateBestScoreArr",value:function(){var t=localStorage.getItem("bestScores");return t?t=JSON.parse(t):[]}},{key:"_checkSize",value:function(){return+document.querySelector("input[name=size]:checked").value}},{key:"deleteCells",value:function(){var t=this;l(this.container.children).forEach((function(e){e!==t.overlay&&(e.textContent?e.removeEventListener("dragstart",t.getButton.bind(t)):(e.removeEventListener("dragover",t.overButton.bind(t)),e.removeEventListener("drop",t.putButton.bind(t))),e.removeEventListener("click",t.moveButton.bind(t)),t.container.removeChild(e))}))}}])&&u(s.prototype,a),e}();function m(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var p=t("div","game-wrapper");document.body.prepend(p),new(function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.state="start",this.time=null,this.sound="off",this.width=this._getWidth(),this.container=t("div","gameSettings-wrapper"),this.menuList=t("ul","menu__list"),this.settings=t("div","settings-page"),this.bestScore=t("div","best-score"),this.savedGames=t("div","saved-games"),this.parent=t("div","parent"),this.count=0,this.progressIdentifier=null,this.init()}var n,s;return n=e,(s=[{key:"_getWidth",value:function(){return+document.documentElement.clientWidth>500?400:300}},{key:"init",value:function(){p.appendChild(this.container),this.game=new d(this),this.menuRender(),this.settingsRender(),this.bestScoreRender(),this.savedGamesRender(),this.game.overlay.appendChild(this.parent),this.parent.appendChild(this.menuList),this.parent.appendChild(this.settings),this.parent.appendChild(this.bestScore),this.parent.appendChild(this.savedGames),this.generateBestScores();var e=this.parent.children;this.children=Array.from(e),this.stateButton=t("span","state-btn","Pause");var n=t("div","time","Time: ".concat(this.count)),s=t("div","move","Moves: ".concat(this.game.moves));this.container.appendChild(this.stateButton),this.container.appendChild(n),this.container.appendChild(s),document.addEventListener("click",this.handleEvent.bind(this))}},{key:"handleEvent",value:function(t){"on"===this.sound&&this.playSound();var e=t.target;if("Resume"===e.innerText||"Pause"===e.innerText){if("Pause"===e.innerText&&"start"===this.state)return;"Pause"===e.innerText&&"playing"===this.state?(this.state="pause",this.menuList.classList.remove("hidden"),this.game.overlay.classList.remove("hidden"),clearInterval(this.progressIdentifier),e.innerText="Resume"):(this.state="playing",this.progressIdentifier=setInterval(this.tick.bind(this),1e3),this.children.forEach((function(t){t.classList.length<2&&t.classList.add("hidden")})),this.game.overlay.classList.add("hidden"),e.innerText="Pause")}if(e.dataset.link)"newGame"===e.dataset.link?(this.state="playing","Resume"===this.stateButton.innerText&&(this.stateButton.innerText="Pause"),this.menuList.classList.add("hidden"),this.game.overlay.classList.add("hidden"),this.progressIdentifier=setInterval(this.tick.bind(this),1e3),this.game.reset()):"settings"===e.dataset.link?(this.menuList.classList.add("hidden"),this.settings.classList.remove("hidden")):"bestScores"===e.dataset.link?(this.menuList.classList.add("hidden"),this.bestScore.classList.remove("hidden")):"back"===e.dataset.link?(this.children.forEach((function(t){t.classList.length<2&&t.classList.add("hidden")})),this.menuList.classList.remove("hidden")):"loadGame"===e.dataset.link?this.getGame():"saveGame"===e.dataset.link&&this.saveGame();else if("off"===e.dataset.sound||"on"===e.dataset.sound){var n=document.getElementById("sound");"off"===this.sound?(e.dataset.sound="on",n.innerText="Sound On",this.sound="on"):(n.innerText="Sound Off",this.sound="off",e.dataset.sound="off")}else e.dataset.close?this.game.modal.close():e.dataset.reset&&(this.count=0,this.progressIdentifier=setInterval(this.tick.bind(this),1e3),this.game.reset(),this.game.modal.close())}},{key:"menuRender",value:function(){this.menuList.innerHTML='\n<span class="menu__link" data-link="newGame">New Game</span>\n <span class="menu__link" data-link="saveGame">Save Game</span>\n <span class="menu__link" data-link="loadGame">Load Game</span>\n <span class="menu__link" data-link="bestScores">Best Scores</span>\n <span class="menu__link" data-link="settings">Settings</span>\n'}},{key:"settingsRender",value:function(){this.settings.classList.add("hidden"),this.settings.innerHTML='<span class="menu-header">Settings</span>\n        <span class="menu-text_big">Field Size</span>\n        <form class=\'form\'>\n    <label for="size" class="menu-text_small">\n           <input type="radio" name="size" id="input" value="3"> 3 X 3\n       </label>\n       <label for="size" class="menu-text_small">\n           <input type="radio" name="size" id="input" value="4" checked> 4 X 4\n       </label>\n       <label for="size" class="menu-text_small">\n       <input type="radio" name="size" id="input" value="5"> 5 X 5\n</label>\n       <label for="size" class="menu-text_small">\n           <input type="radio" name="size" id="input" value="6"> 6 X 6\n   </label>\n   <label for="size" class="menu-text_small">\n   <input type="radio" name="size" id="input" value="7"> 7 X 7\n</label>\n<label for="size" class="menu-text_small">\n<input type="radio" name="size" id="input" value="8"> 8 X 8\n</label>\n    </form>\n    <span id="sound" data-sound="off" class="menu-text_big sound">Sound Off</span>\n    <span class="menu-text_big" id="back" data-link="back" >Go back</span>\n    '}},{key:"bestScoreRender",value:function(){this.bestScore.classList.add("hidden"),this.bestScore.innerHTML='<span class="menu-header">Best Score</span>\n        <ul class="best-score_list">\n        <li class="best-score_link menu-text_small"><span>Moves</span><span>Time</span></li>\n        </ul>\n\n        <span class="menu-text_big" id="back" data-link="back" >Go back</span>\n        '}},{key:"savedGamesRender",value:function(){this.savedGames.classList.add("hidden"),this.savedGames.innerHTML='\n        <span class="load_game menu-text_small">You haven\'t got any saved games yet</span>\n        <span class="menu-text_big" id="back" data-link="back" >Go back</span>\n        '}},{key:"tick",value:function(){this.count++,this.sec=this.count>=60?this.count%60:this.count,this.min=Math.floor(this.count/60),document.querySelector(".time").innerHTML="Time: ".concat(this.addZero(this.min),": ").concat(this.addZero(this.sec))}},{key:"addZero",value:function(t){return t<10?"0".concat(t):"".concat(t)}},{key:"saveGame",value:function(){var t={};t.count=this.count,t.moves=this.game.moves,t.template=this.game.currentTemplate,t.image=this.game.image,t.size=this.game.q;var e=JSON.stringify(t);localStorage.setItem("game",e),document.querySelector(".load_game").innerText="Your game is saved!",this.menuList.classList.add("hidden"),this.savedGames.classList.remove("hidden")}},{key:"getGame",value:function(){var t=localStorage.getItem("game");t?(t=JSON.parse(t),this.game.loadGame(t),this.count=t.count,this.tick()):(document.querySelector(".load_game").innerText="You have no saved games yet",this.menuList.classList.add("hidden"),this.savedGames.classList.remove("hidden"))}},{key:"playSound",value:function(){var e=t("audio");e.setAttribute("src","./assets/sounds/english.mp3"),e.load(),e.play(),e=void 0}},{key:"generateBestScores",value:function(){var t=this,e=localStorage.getItem("bestScores"),n=document.querySelector(".best-score_list");if(e){e=(e=JSON.parse(e)).sort((function(t,e){return t.moves-e.moves}));var s='<li class="best-score_link menu-text_small"><span>№</span><span>Size</span><span>Moves</span><span>Time</span></li>';e.length>10&&(e=e.slice(0,10)),e.forEach((function(e,n){return s+='<li class="best-score_link menu-text_small"><span>'.concat(n+1,".</span><span>").concat(e.size,"x").concat(e.size,"</span><span>").concat(e.moves,"</span><span> ").concat(t.addZero(Math.floor(e.count/60)),": ").concat(t.addZero(e.count%60),"</span></li>")})),n.innerHTML=s}}}])&&m(n.prototype,s),e}())})();