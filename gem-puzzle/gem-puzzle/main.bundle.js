(()=>{"use strict";function t(t,e,n){var i=null;return t&&(i=window.document.createElement(t)),e&&i.classList.add(e),n&&(i.innerHTML=n),i}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var n=function(){function n(t){var e=t.left,i=t.top,s=t.ind,a=t.image,r=t.q;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.left=e,this.top=i,this.ind="number"==typeof s?s:"",this.image=a,this.q=r}var i,s;return i=n,(s=[{key:"getPos",value:function(){this.size=400/this.q,this.bgPosX="".concat(400-this.left*this.size,"px"),this.bgPosY="".concat(400-this.top*this.size,"px")}},{key:"render",value:function(){return this.size=400/this.q,this.container=t("div","fieldcell","".concat(this.ind)),this.container.style.backgroundImage="url(assets/images/".concat(this.image,")"),this.container.style.backgroundSize="".concat(400,"px ").concat(400,"px"),this.container.style.width="".concat(100/this.q,"%"),this.container.style.height="".concat(100/this.q,"%"),this.container.style.top="".concat(this.top*this.size,"px"),this.container.style.left="".concat(this.left*this.size,"px"),this.container.style.backgroundPositionX=this.bgPosX,this.container.style.backgroundPositionY=this.bgPosY,""===this.ind&&(this.container.style.opacity="0"),this.container}}])&&e(i.prototype,s),n}();function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(o,t);var e,n,i=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,i=r(e);if(n){var s=r(this).constructor;t=Reflect.construct(i,arguments,s)}else t=i.apply(this,arguments);return a(this,t)});function o(t){var e=t.left,n=t.top,s=t.ind,a=t.image,r=t.q;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this,{left:e,top:n,ind:s,image:a,q:r})}return o}(n);function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var l,u=function(t){if(Array.isArray(t))return c(t)}(l=Array(148).keys())||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(l)||function(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}(l)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function p(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}u=u.map((function(t){return"".concat(t+1,".jpg")})),console.log(u);var m=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.buttons=[],this.image=this._getImage(u),this.correctTemplate=[],this.container=t("div","gamefield"),this.overlay=t("span","overlay"),this.count=0,this.moves=0,this.q=4,this.prevQ=null,this.init()}var i,s;return i=e,(s=[{key:"init",value:function(){y.appendChild(this.container),this.container.appendChild(this.overlay),this.makeCorrectTemplate(),console.log(this.correctTemplate),this.render(this.correctTemplate)}},{key:"makeCorrectTemplate",value:function(){for(var t=0;t<Math.pow(this.q,2)-1;t++){var e=t%this.q,i=(t-e)/this.q,s=t+1,a=this.image,r=this.q;this.correctTemplate.push(new n({left:e,top:i,ind:s,image:a,q:r}))}this.correctTemplate.push(new o({left:this.q-1,top:this.q-1,ind:"",image:this.image,q:this.q})),this.correctTemplate.forEach((function(t){return t.getPos()}))}},{key:"render",value:function(t){var e=this;t.forEach((function(t){var n=t.render();n.addEventListener("click",e.moveButton.bind(e)),e.container.appendChild(n)}))}},{key:"shuffle",value:function(){var t=this,e=d(this.correctTemplate).pop();this.buttons=[];for(var i=d(Array(Math.pow(this.q,2)-1).keys()).sort((function(){return Math.random()-.5})).map((function(t){return t+1})),s=function(e){var s=e%t.q,a=(e-s)/t.q,r=i[e],o=t.image,c=t.q,l=t.correctTemplate.find((function(t){return t.ind===r})),u=new n({left:s,top:a,ind:r,image:o,q:c}),h=Object.create(u);h.bgPosX=l.bgPosX,h.bgPosY=l.bgPosY,t.buttons.push(h)},a=0;a<Math.pow(this.q,2)-1;a++)s(a);(e=new o({left:this.q-1,top:this.q-1,ind:"",image:this.image,q:this.q})).getPos(),this.buttons.push(e),console.log(this.buttons),this.render(this.buttons)}},{key:"_getImage",value:function(t){return t[Math.floor(Math.random()*t.length)]}},{key:"reset",value:function(){var t=this;this.image=this._getImage(u),this.prevQ=this.q,this.q=this._checkSize(),this.q!==this.prevQ&&this.makeCorrectTemplate(),d(this.container.children).forEach((function(e){e.classList.length<2&&(e.removeEventListener("click",t.moveButton.bind(t)),t.container.removeChild(e))})),setTimeout((function(){t.shuffle()}),0),this.moves=0,document.querySelector(".move").innerHTML="Moves: ".concat(this.moves),b.count=0,console.log(this.q)}},{key:"moveButton",value:function(t){if("pause"!==b.state){this.moves++,document.querySelector(".move").innerHTML="Moves: ".concat(this.moves);var e=t.target.innerHTML,n=this.buttons.find((function(t){return t.ind==e})),i=this.buttons.find((function(t){return""===t.ind}));if(n&&i){var s=n.left,a=n.top,r=i.left,o=i.top;1===Math.abs(s-r)+Math.abs(a-o)&&(Object.assign(i,{left:s,top:a}),n.left=r,n.top=o,n.container.style.top="".concat(n.top*n.size,"px"),n.container.style.left="".concat(n.left*n.size,"px"),i.container.style.top="".concat(i.top*i.size,"px"),i.container.style.left="".concat(i.left*i.size,"px"),this.checkTemplate())}}}},{key:"checkTemplate",value:function(){for(var t=this,e=function(e){var n=e+1,i=t.correctTemplate.find((function(t){return t.ind===n})),s=t.buttons.find((function(t){return t.ind===n}));return i.left!==s.left||i.top!==s.top?{v:void 0}:void 0},n=0;n<this.buttons.length-1;n++){var i=e(n);if("object"===h(i))return i.v}this.ifWin()}},{key:"ifWin",value:function(){this.buttons.find((function(t){return""===t.ind})).container.style.opacity="1",alert("вы победили")}},{key:"_checkSize",value:function(){return+document.querySelector("input[name=size]:checked").value}}])&&p(i.prototype,s),e}();function v(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var y=t("div","game-wrapper");document.body.prepend(y);var b=new(function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.state="start",this.time=null,this.sound="off",this.container=t("div","gameSettings-wrapper"),this.menuList=t("ul","menu__list"),this.settings=t("div","settings-page"),this.bestScore=t("div","best-score"),this.savedGames=t("div","saved-games"),this.parent=t("div","parent"),this.count=0,this.progressIdentifier=null,this.init()}var n,i;return n=e,(i=[{key:"init",value:function(){y.appendChild(this.container),this.game=new m,this.menuRender(),this.settingsRender(),this.bestScoreRender(),this.savedGamesRender(),this.game.overlay.appendChild(this.parent),this.parent.appendChild(this.menuList),this.parent.appendChild(this.settings),this.parent.appendChild(this.bestScore),this.parent.appendChild(this.savedGames);var e=this.parent.children;this.children=Array.from(e),this.stateButton=t("span","state-btn","Pause");var n=t("div","time","Time: ".concat(this.count)),i=t("div","move","Moves: ".concat(this.game.moves));this.container.appendChild(this.stateButton),this.container.appendChild(n),this.container.appendChild(i),document.addEventListener("click",this.handleEvent.bind(this))}},{key:"handleEvent",value:function(t){var e=t.target;if("Resume"===e.innerText||"Pause"===e.innerText){if(console.log(e),"Pause"===e.innerText&&"start"===this.state)return;"Pause"===e.innerText&&"playing"===this.state?(this.state="pause",this.menuList.classList.remove("hidden"),this.game.overlay.classList.remove("hidden"),clearInterval(this.progressIdentifier),e.innerText="Resume"):(this.state="playing",this.progressIdentifier=setInterval(this.tick.bind(this),1e3),this.children.forEach((function(t){t.classList.length<2&&t.classList.add("hidden")})),this.game.overlay.classList.add("hidden"),e.innerText="Pause")}if(e.dataset.link)if("newGame"===e.dataset.link)this.state="playing","Resume"===this.stateButton.innerText&&(this.stateButton.innerText="Pause"),this.menuList.classList.add("hidden"),this.game.overlay.classList.add("hidden"),this.progressIdentifier=setInterval(this.tick,1e3),this.game.reset();else if("settings"===e.dataset.link)this.menuList.classList.add("hidden"),this.settings.classList.remove("hidden");else if("bestScores"===e.dataset.link)this.menuList.classList.add("hidden"),this.bestScore.classList.remove("hidden");else if("back"===e.dataset.link)this.children.forEach((function(t){t.classList.length<2&&t.classList.add("hidden")})),this.menuList.classList.remove("hidden");else{if("loadGame"===e.dataset.link)return;if("saveGame"===e.dataset.link)return}}},{key:"menuRender",value:function(){this.menuList.innerHTML='\n<span class="menu__link" data-link="newGame">New Game</span>\n <span class="menu__link" data-link="saveGame">Save Game</span>\n <span class="menu__link" data-link="loadGame">Load Game</span>\n <span class="menu__link" data-link="bestScores">Best Scores</span>\n <span class="menu__link" data-link="settings">Settings</span>\n'}},{key:"settingsRender",value:function(){this.settings.classList.add("hidden"),this.settings.innerHTML='<span class="menu-header">Settings</span>\n        <span class="menu-text_big">Field Size</span>\n        <form class=\'form\'>\n    <label for="size" class="menu-text_small">\n           <input type="radio" name="size" id="input" value="3"> 3 X 3\n       </label>\n       <label for="size" class="menu-text_small">\n           <input type="radio" name="size" id="input" value="4" checked> 4 X 4\n       </label>\n       <label for="size" class="menu-text_small">\n           <input type="radio" name="size" id="input" value="6"> 6 X 6\n   </label>\n    </form>\n    <span id="sound" data-sound="off" class="menu-text_big sound">Sound Off</span>\n    <span class="menu-text_big" id="back" data-link="back" >Go back</span>\n    '}},{key:"bestScoreRender",value:function(){this.bestScore.classList.add("hidden"),this.bestScore.innerHTML='<span class="menu-header">Best Score</span>\n        <ul class="best-score_list">\n        <li class="best-score_link menu-text_small"><span>Moves</span><span>Time</span></li>\n        </ul>\n\n        <span class="menu-text_big" id="back" data-link="back" >Go back</span>\n        '}},{key:"savedGamesRender",value:function(){this.savedGames.classList.add("hidden"),this.savedGames.innerHTML='<span class="menu-header">Load Game</span>\n        <ul class="saved-games_list">\n        <li class="saved-games_link menu-text_small"><span>Date</span><span>Moves</span><span>Time</span></li>\n        </ul>\n        <span class="menu-text_big" id="back" data-link="back" >Go back</span>\n        '}},{key:"tick",value:function(){this.count++;var t=this.count>=60?this.count%60:this.count,e=Math.floor(this.count/60);document.querySelector(".time").innerHTML="Time: ".concat(this.addZero(e),": ").concat(this.addZero(t))}},{key:"addZero",value:function(t){return t<10?"0".concat(t):"".concat(t)}}])&&v(n.prototype,i),e}())})();